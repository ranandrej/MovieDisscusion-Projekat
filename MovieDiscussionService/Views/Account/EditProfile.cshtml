@model Common.DTOs.RegisterDTO
@{
    ViewBag.Title = "Edit Profile";
}

<h2>Edit Profile</h2>

@using (Html.BeginForm("EditProfile", "Account", FormMethod.Post, new { enctype = "multipart/form-data", @class = "form" }))
{
    <div class="form-group">
        @Html.LabelFor(m => m.FullName)
        @Html.TextBoxFor(m => m.FullName, new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.Gender)
        @Html.DropDownListFor(m => m.Gender,
            new SelectList(new[] { "Male", "Female", "Other" }, Model?.Gender),
            "Select gender",
            new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.Country)
        @Html.TextBoxFor(m => m.Country, new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.City)
        @Html.TextBoxFor(m => m.City, new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.Address)
        @Html.TextBoxFor(m => m.Address, new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.Label("New Password (optional)")
        @Html.PasswordFor(m => m.Password, new { @class = "form-control" })
    </div>

    <!-- Slika -->
    <div class="form-group">
        @Html.Label("Profile Photo")
        <input type="file" id="PhotoFile" name="PhotoFile" class="form-control" accept="image/*" />

        <div style="margin-top:10px;">
            <p>Current / Preview:</p>
            @if (!string.IsNullOrEmpty(Model?.PhotoUrl))
            {
                <img id="photoPreview"
                     src="@Model.PhotoUrl"
                     style="max-height:200px; display:block;" />
            }
            else
            {
                <span id="noPhotoText" class="text-muted">No photo available</span>
                <img id="photoPreview" style="max-height:200px; display:none;" />
            }
        </div>
    </div>

    <br />
    <button type="submit" class="btn btn-primary">Save Changes</button>
}

@section scripts {
    <script>
        document.getElementById('PhotoFile').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (!file) return;

            const url = URL.createObjectURL(file);
            const preview = document.getElementById('photoPreview');
            const noPhotoText = document.getElementById('noPhotoText');

            preview.src = url;
            preview.style.display = 'block';
            if (noPhotoText) noPhotoText.style.display = 'none';
        });
    </script>
}
